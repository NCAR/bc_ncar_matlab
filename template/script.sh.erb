#!/usr/bin/env bash

# Clean the environment
module purge

# Set working directory to home directory
cd "${HOME}"

(
# Ensure that the user's configured login shell is used
export SHELL="$(getent passwd $USER | cut -d: -f7)"

# use a safe PATH to boot the desktop because dbus-launch can be
# in another location from a python/conda installation and that will
# conflict and cause issues. See https://github.com/OSC/ondemand/issues/700 for more.
SAFE_PATH="/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/bin"

# Start up desktop
echo "Launching plasma ..."
PATH="$SAFE_PATH" startplasma-x11
) &

module restore

#
# Start MATLAB
#

# Load the required environment
module load <%= context.auto_modules_matlab %>

# Launch MATLAB
module list
set -x
matlab -desktop
